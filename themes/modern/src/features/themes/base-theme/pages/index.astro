---
import fs from 'node:fs';

import Footer from '@/features/themes/base-theme/components/footer/Footer.astro';
import GallerySection from '@/features/themes/base-theme/components/gallery-section/GallerySection.astro';
import Hero from '@/features/themes/base-theme/components/hero/Hero.astro';
import PhotoSwipe from '@/features/themes/base-theme/components/lightbox/PhotoSwipe.astro';
import SubGalleries from '@/features/themes/base-theme/components/sub-galleries/SubGalleries.astro';
import MainLayout from '@/features/themes/base-theme/layouts/MainLayout.astro';

import type { GalleryData } from '@/features/themes/base-theme/types/gallery';

// Dynamically import gallery.json from source path or fallback to local
const galleryJsonPath = process.env.GALLERY_JSON_PATH || './gallery.json';
const galleryData = JSON.parse(fs.readFileSync(galleryJsonPath, 'utf8'));

const gallery = galleryData as GalleryData;

const { title, description, headerImage, metadata, sections, subGalleries, mediaBaseUrl, url } = gallery;
---

<MainLayout title={title} description={description} metadata={metadata} url={url}>
  <Hero title={title} description={description} backgroundImage={headerImage} mediaBaseUrl={mediaBaseUrl} />

  {
    subGalleries && subGalleries.galleries.length > 0 && (
      <SubGalleries
        title={subGalleries.title}
        description={subGalleries.description}
        subGalleries={subGalleries.galleries}
      />
    )
  }
  {
    sections.map((section, sectionIndex) => (
      <GallerySection section={section} sectionIndex={sectionIndex} mediaBaseUrl={mediaBaseUrl} />
    ))
  }

  <Footer />
  <PhotoSwipe />
</MainLayout>
